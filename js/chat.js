/**
 * ============================================================
 * CHAT.JS ‚Äî –ß–∞—Ç –ø—Ä–æ–µ–∫—Ç–∞ –ü—Ä–æ—Ñ–†–µ–º–æ–Ω—Ç
 * ============================================================
 * 
 * –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
 * - –û—Ç–ø—Ä–∞–≤–∫–∞/–ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
 * - –ê–≤—Ç–æ–æ—Ç–≤–µ—Ç—ã –º–µ–Ω–µ–¥–∂–µ—Ä–∞ (—Å–∏–º—É–ª—è—Ü–∏—è)
 * - –ì–æ—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (–ø—Ä–µ—Å–µ—Ç—ã)
 * - –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä "–ø–µ—á–∞—Ç–∞–µ—Ç..."
 * - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –≤ sessionStorage
 * - –£–º–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã
 * - –ê–Ω–∏–º–∞—Ü–∏–∏ –∏ –∑–≤—É–∫–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
 * 
 * ============================================================
 */

(function() {
  'use strict';

  // ============================================================
  // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
  // ============================================================
  
  const CONFIG = {
    // –ó–∞–¥–µ—Ä–∂–∫–∏ (–º—Å)
    typingDelay: { min: 800, max: 2500 },
    responseDelay: { min: 1500, max: 4000 },
    
    // –•—Ä–∞–Ω–∏–ª–∏—â–µ
    storageKey: 'profremont_chat_history',
    maxHistoryMessages: 50,
    
    // UI
    scrollThreshold: 200,
    messageAnimationDuration: 300,
    
    // –†–∞–±–æ—á–∏–µ —á–∞—Å—ã
    workingHours: { start: 9, end: 20 },
    
    // –ó–≤—É–∫–∏ (–º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å)
    soundEnabled: false,
    soundUrl: '/sounds/message.mp3'
  };

  // ============================================================
  // –ë–ê–ó–ê –û–¢–í–ï–¢–û–í –ú–ï–ù–ï–î–ñ–ï–†–ê
  // ============================================================
  
  const RESPONSES = {
    // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
    greetings: [
      '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! üëã –†–∞–¥, —á—Ç–æ –≤—ã –Ω–∞–ø–∏—Å–∞–ª–∏. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å —Å –≤–∞—à–∏–º –ø—Ä–æ–µ–∫—Ç–æ–º?',
      '–î–æ–±—Ä—ã–π –¥–µ–Ω—å! –°–ø–∞—Å–∏–±–æ, —á—Ç–æ –æ–±—Ä–∞—Ç–∏–ª–∏—Å—å –∫ –Ω–∞–º. –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ –≤–∞—à–µ–º –æ–±—ä–µ–∫—Ç–µ ‚Äî –ø–æ—Å—Ç–∞—Ä–∞—é—Å—å –ø–æ–º–æ—á—å.',
      '–ü—Ä–∏–≤–µ—Ç! üè† –ì–æ—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã –ø–æ —Ä–µ–º–æ–Ω—Ç—É. –ß—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç?'
    ],
    
    // –û—Ç–≤–µ—Ç—ã –Ω–∞ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
    keywords: {
      '—Ü–µ–Ω–∞|—Å—Ç–æ–∏–º–æ—Å—Ç—å|—Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç|–ø—Ä–∞–π—Å|—Ä–∞—Å—Ü–µ–Ω–∫–∏|–±—é–¥–∂–µ—Ç': [
        '–°—Ç–æ–∏–º–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø–ª–æ—â–∞–¥–∏, —Å–æ—Å—Ç–æ—è–Ω–∏—è –æ–±—ä–µ–∫—Ç–∞ –∏ –ø–æ–∂–µ–ª–∞–Ω–∏–π –ø–æ –æ—Ç–¥–µ–ª–∫–µ. –î–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞ –º–Ω–µ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å:\n\n‚Ä¢ –ü–ª–æ—â–∞–¥—å –ø–æ–º–µ—â–µ–Ω–∏—è (–º¬≤)\n‚Ä¢ –¢–∏–ø –æ–±—ä–µ–∫—Ç–∞ (–Ω–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∞/–≤—Ç–æ—Ä–∏—á–∫–∞)\n‚Ä¢ –ö–∞–∫–æ–π —Ä–µ–º–æ–Ω—Ç –Ω—É–∂–µ–Ω (–∫–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–∏–π/–∫–∞–ø–∏—Ç–∞–ª—å–Ω—ã–π/–ø–æ–¥ –∫–ª—é—á)\n\n–ú–æ–∂–µ—Ç–µ –ø—Ä–∏—Å–ª–∞—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É –∏–ª–∏ —Ñ–æ—Ç–æ ‚Äî —Å–æ—Ä–∏–µ–Ω—Ç–∏—Ä—É—é –ø–æ –±—é–¥–∂–µ—Ç—É –±—ã—Å—Ç—Ä–µ–µ. üìã',
        '–ß—Ç–æ–±—ã –Ω–∞–∑–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å, —Ä–∞—Å—Å–∫–∞–∂–∏—Ç–µ:\n\n1. –ö–∞–∫–∞—è –ø–ª–æ—â–∞–¥—å?\n2. –ß—Ç–æ —Å–µ–π—á–∞—Å –≤ –∫–≤–∞—Ä—Ç–∏—Ä–µ (—á–µ—Ä–Ω–æ–≤–∞—è –æ—Ç–¥–µ–ª–∫–∞, –ø–æ—Å–ª–µ —Å—Ç—Ä–æ–∏—Ç–µ–ª–µ–π, –∂–∏–ª–æ–µ)?\n3. –ö–∞–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª—É—á–∏—Ç—å?\n\n–ï—Å–ª–∏ –µ—Å—Ç—å —Ñ–æ—Ç–æ –∏–ª–∏ –ø–ª–∞–Ω ‚Äî –ø—Ä–∏—Å—ã–ª–∞–π—Ç–µ, –±—É–¥–µ—Ç —Ç–æ—á–Ω–µ–µ. üí∞'
      ],
      
      '—Å—Ä–æ–∫|—Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏|–∫–∞–∫ –¥–æ–ª–≥–æ|–∫–æ–≥–¥–∞|–¥–∞—Ç–∞|–≥—Ä–∞—Ñ–∏–∫': [
        '–°—Ä–æ–∫–∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –æ–±—ä—ë–º–∞ —Ä–∞–±–æ—Ç:\n\n‚Ä¢ –ö–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–º–æ–Ω—Ç —Å—Ç—É–¥–∏–∏: 7‚Äì14 –¥–Ω–µ–π\n‚Ä¢ –ö–∞–ø–∏—Ç–∞–ª—å–Ω—ã–π —Ä–µ–º–æ–Ω—Ç 1-–∫–æ–º–Ω.: 3‚Äì5 –Ω–µ–¥–µ–ª—å\n‚Ä¢ –†–µ–º–æ–Ω—Ç –ø–æ–¥ –∫–ª—é—á 2-–∫–æ–º–Ω.: 5‚Äì8 –Ω–µ–¥–µ–ª—å\n\n–¢–æ—á–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ —Ñ–∏–∫—Å–∏—Ä—É–µ–º –≤ –¥–æ–≥–æ–≤–æ—Ä–µ. –ö–æ–≥–¥–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç–µ –Ω–∞—á–∞—Ç—å? üìÖ',
        '–û–±—ã—á–Ω–æ —É–∫–ª–∞–¥—ã–≤–∞–µ–º—Å—è –≤ 2‚Äì6 –Ω–µ–¥–µ–ª—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–ª–æ—â–∞–¥–∏ –∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏. –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ –≤–∞—à–µ–º –æ–±—ä–µ–∫—Ç–µ ‚Äî –Ω–∞–∑–æ–≤—É –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–µ —Å—Ä–æ–∫–∏. ‚è±Ô∏è'
      ],
      
      '–º–∞—Ç–µ—Ä–∏–∞–ª|–ø–ª–∏—Ç–∫–∞|–ª–∞–º–∏–Ω–∞—Ç|–∫—Ä–∞—Å–∫–∞|–æ–±–æ–∏|–ø–∞—Ä–∫–µ—Ç': [
        '–†–∞–±–æ—Ç–∞–µ–º —Å –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–º–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏ —Ä–∞–∑–Ω—ã—Ö —Ü–µ–Ω–æ–≤—ã—Ö –∫–∞—Ç–µ–≥–æ—Ä–∏–π:\n\n‚Ä¢ –≠–∫–æ–Ω–æ–º: –õ–µ—Ä—É–∞ –ú–µ—Ä–ª–µ–Ω, –ü–µ—Ç—Ä–æ–≤–∏—á\n‚Ä¢ –°—Ä–µ–¥–Ω–∏–π: Kerama Marazzi, Quick-Step\n‚Ä¢ –ü—Ä–µ–º–∏—É–º: –ø–æ–¥ –∑–∞–∫–∞–∑ –ø–æ –≤–∞—à–µ–º—É –¢–ó\n\n–ú–æ–∂–µ–º –∑–∞–∫—É–ø–∏—Ç—å —Å–∞–º–∏ –∏–ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –≤–∞—à–∏–º–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏. –ß—Ç–æ –≤–∞–º –±–ª–∏–∂–µ? üõ†Ô∏è',
        '–ü–æ–¥–±–∏—Ä–∞–µ–º –º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø–æ–¥ –±—é–¥–∂–µ—Ç –∏ –∑–∞–¥–∞—á—É. –ú–æ–∂–µ–º:\n\n‚Ä¢ –î–∞—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Å–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—é —Ü–µ–Ω–∞/–∫–∞—á–µ—Å—Ç–≤–æ\n‚Ä¢ –ó–∞–∫—É–ø–∏—Ç—å –≤—Å—ë —Å–∞–º–∏ —Å–æ —Å–∫–∏–¥–∫–∞–º–∏ –æ—Ç –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤\n‚Ä¢ –†–∞–±–æ—Ç–∞—Ç—å —Å –≤–∞—à–∏–º–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏\n\n–ß—Ç–æ –∏–º–µ–Ω–Ω–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç? üé®'
      ],
      
      '–≥–∞—Ä–∞–Ω—Ç–∏—è|–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å|–¥–æ–≥–æ–≤–æ—Ä|–∫–∞—á–µ—Å—Ç–≤–æ': [
        '–î–∞—ë–º –≥–∞—Ä–∞–Ω—Ç–∏—é 12 –º–µ—Å—è—Ü–µ–≤ –Ω–∞ –≤—Å–µ –æ—Ç–¥–µ–ª–æ—á–Ω—ã–µ —Ä–∞–±–æ—Ç—ã. –†–∞–±–æ—Ç–∞–µ–º –ø–æ –¥–æ–≥–æ–≤–æ—Ä—É —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å–º–µ—Ç–æ–π ‚Äî —Ü–µ–Ω–∞ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ.\n\n–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ–π–¥—ë—Ç –Ω–µ —Ç–∞–∫ ‚Äî –∏—Å–ø—Ä–∞–≤–∏–º –∑–∞ —Å–≤–æ–π —Å—á—ë—Ç. –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º –Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ. ‚úÖ',
        '–í—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ–º –ø–æ –¥–æ–≥–æ–≤–æ—Ä—É:\n\n‚Ä¢ –§–∏–∫—Å-—Å–º–µ—Ç–∞ (—Ü–µ–Ω–∞ –Ω–µ —Ä–∞—Å—Ç—ë—Ç)\n‚Ä¢ –ü–æ—ç—Ç–∞–ø–Ω–∞—è –æ–ø–ª–∞—Ç–∞\n‚Ä¢ –ì–∞—Ä–∞–Ω—Ç–∏—è 12 –º–µ—Å. –Ω–∞ —Ä–∞–±–æ—Ç—ã\n‚Ä¢ –ì–∞—Ä–∞–Ω—Ç–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª–µ–π –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª—ã\n\n–ü—Ä–æ–∑—Ä–∞—á–Ω–æ –∏ –±–µ–∑ —Å—é—Ä–ø—Ä–∏–∑–æ–≤. üìù'
      ],
      
      '–∑–∞–º–µ—Ä|–ø—Ä–∏–µ—Ö–∞—Ç—å|–ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å|–≤—ã–µ–∑–¥|–≤–∏–∑–∏—Ç': [
        '–ó–∞–º–µ—Ä –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π! üìê –í—ã–µ–∑–∂–∞–µ–º –≤ —É–¥–æ–±–Ω–æ–µ –¥–ª—è –≤–∞—Å –≤—Ä–µ–º—è. –ü–æ—Å–ª–µ –∑–∞–º–µ—Ä–∞:\n\n‚Ä¢ –°–æ—Å—Ç–∞–≤–∏–º –ø–æ–¥—Ä–æ–±–Ω—É—é —Å–º–µ—Ç—É\n‚Ä¢ –ü–æ–∫–∞–∂–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏\n‚Ä¢ –û—Ç–≤–µ—Ç–∏–º –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ –º–µ—Å—Ç–µ\n\n–ö–æ–≥–¥–∞ –≤–∞–º —É–¥–æ–±–Ω–æ? –†–∞–±–æ—Ç–∞–µ–º —Å 9:00 –¥–æ 20:00, –≤–∫–ª—é—á–∞—è —Å—É–±–±–æ—Ç—É.',
        '–ú–æ–≥—É –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –≤—ã–µ–∑–¥ –∑–∞–º–µ—Ä—â–∏–∫–∞. –û–Ω –ø–æ—Å–º–æ—Ç—Ä–∏—Ç –æ–±—ä–µ–∫—Ç, —Å–Ω–∏–º–µ—Ç —Ä–∞–∑–º–µ—Ä—ã –∏ –æ—Ç–≤–µ—Ç–∏—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ –º–µ—Å—Ç–µ.\n\n–ö–∞–∫–æ–π –∞–¥—Ä–µ—Å –∏ –∫–æ–≥–¥–∞ —É–¥–æ–±–Ω–æ –ø—Ä–∏–Ω—è—Ç—å? üè†'
      ],
      
      '—Å–∞–Ω—É–∑–µ–ª|–≤–∞–Ω–Ω–∞—è|—Ç—É–∞–ª–µ—Ç|–¥—É—à|—Å–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞': [
        '–†–µ–º–æ–Ω—Ç —Å–∞–Ω—É–∑–ª–∞ ‚Äî –Ω–∞—à–∞ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è! üöø –î–µ–ª–∞–µ–º:\n\n‚Ä¢ –ó–∞–º–µ–Ω—É —Ç—Ä—É–± –∏ —Ä–∞–∑–≤–æ–¥–∫—É\n‚Ä¢ –ì–∏–¥—Ä–æ–∏–∑–æ–ª—è—Ü–∏—é\n‚Ä¢ –£–∫–ª–∞–¥–∫—É –ø–ª–∏—Ç–∫–∏\n‚Ä¢ –£—Å—Ç–∞–Ω–æ–≤–∫—É —Å–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∏ –∏ –º–µ–±–µ–ª–∏\n\n–ü–ª–æ—â–∞–¥—å —Å–∞–Ω—É–∑–ª–∞ –∫–∞–∫–∞—è? –ï—Å—Ç—å –ª–∏ —Ñ–æ—Ç–æ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è?',
        '–° —Å–∞–Ω—É–∑–ª–∞–º–∏ —Ä–∞–±–æ—Ç–∞–µ–º –º–Ω–æ–≥–æ ‚Äî –∑–Ω–∞–µ–º –≤—Å–µ –Ω—é–∞–Ω—Å—ã. –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ:\n\n‚Ä¢ –ö–∞–∫–∞—è –ø–ª–æ—â–∞–¥—å?\n‚Ä¢ –ß—Ç–æ —Ö–æ—Ç–∏—Ç–µ: –¥—É—à –∏–ª–∏ –≤–∞–Ω–Ω–∞?\n‚Ä¢ –ù—É–∂–Ω–∞ –ª–∏ –ø–µ—Ä–µ–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞?\n\n–ú–æ–∂–Ω–æ —Ñ–æ—Ç–æ –ø—Ä–∏—Å–ª–∞—Ç—å ‚Äî —Å–æ—Ä–∏–µ–Ω—Ç–∏—Ä—É—é –ø–æ –±—é–¥–∂–µ—Ç—É –∏ —Å—Ä–æ–∫–∞–º. üõÅ'
      ],
      
      '–∫—É—Ö–Ω—è|–≥–∞—Ä–Ω–∏—Ç—É—Ä|—Ñ–∞—Ä—Ç—É–∫|–≤—ã—Ç—è–∂–∫–∞': [
        '–ö—É—Ö–Ω—è ‚Äî –≤–∞–∂–Ω–∞—è —á–∞—Å—Ç—å! üç≥ –î–µ–ª–∞–µ–º:\n\n‚Ä¢ –≠–ª–µ–∫—Ç—Ä–∏–∫—É –ø–æ–¥ —Ç–µ—Ö–Ω–∏–∫—É\n‚Ä¢ –í—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ —Å—Ç–µ–Ω –∏ –ø–æ–ª–∞\n‚Ä¢ –£–∫–ª–∞–¥–∫—É —Ñ–∞—Ä—Ç—É–∫–∞\n‚Ä¢ –°–±–æ—Ä–∫—É –∏ —É—Å—Ç–∞–Ω–æ–≤–∫—É –≥–∞—Ä–Ω–∏—Ç—É—Ä–∞\n\n–ö–∞–∫–∞—è –ø–ª–æ—â–∞–¥—å –∫—É—Ö–Ω–∏? –ì–∞—Ä–Ω–∏—Ç—É—Ä —É–∂–µ –≤—ã–±—Ä–∞–ª–∏ –∏–ª–∏ –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å?',
        '–ü–æ –∫—É—Ö–Ω–µ –º–æ–≥—É –ø–æ–º–æ—á—å —Å:\n\n‚Ä¢ –ü–ª–∞–Ω–∏—Ä–æ–≤–∫–æ–π —Ä–æ–∑–µ—Ç–æ–∫ –ø–æ–¥ —Ç–µ—Ö–Ω–∏–∫—É\n‚Ä¢ –£–∫–ª–∞–¥–∫–æ–π –ø–ª–∏—Ç–∫–∏/—Ñ–∞—Ä—Ç—É–∫–∞\n‚Ä¢ –£—Å—Ç–∞–Ω–æ–≤–∫–æ–π –≥–∞—Ä–Ω–∏—Ç—É—Ä–∞\n‚Ä¢ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º —Ç–µ—Ö–Ω–∏–∫–∏\n\n–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ ‚Äî —á—Ç–æ —Å–µ–π—á–∞—Å –µ—Å—Ç—å –∏ —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª—É—á–∏—Ç—å? üè°'
      ],
      
      '—ç–ª–µ–∫—Ç—Ä–∏–∫–∞|—Ä–æ–∑–µ—Ç–∫–∏|—Å–≤–µ—Ç|–ø—Ä–æ–≤–æ–¥–∫–∞|—â–∏—Ç–æ–∫': [
        '–≠–ª–µ–∫—Ç—Ä–∏–∫–∞ ‚Äî –¥–µ–ª–∞–µ–º –ø–æ –≤—Å–µ–º –Ω–æ—Ä–º–∞–º! ‚ö° –í–∫–ª—é—á–∞–µ—Ç:\n\n‚Ä¢ –ó–∞–º–µ–Ω—É –ø—Ä–æ–≤–æ–¥–∫–∏ (–º–µ–¥—å)\n‚Ä¢ –°–±–æ—Ä–∫—É —â–∏—Ç–∫–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∞–º–∏\n‚Ä¢ –†–∞–∑–≤–æ–¥–∫—É –ø–æ–¥ –≤—Å–µ —Ç–æ—á–∫–∏\n‚Ä¢ –£—Å—Ç–∞–Ω–æ–≤–∫—É —Ä–æ–∑–µ—Ç–æ–∫ –∏ –≤—ã–∫–ª—é—á–∞—Ç–µ–ª–µ–π\n\n–°–∫–æ–ª—å–∫–æ –∫–æ–º–Ω–∞—Ç? –ï—Å—Ç—å –ª–∏ –ø–ª–∞–Ω —Å —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–æ–π –º–µ–±–µ–ª–∏?',
        '–° —ç–ª–µ–∫—Ç—Ä–∏–∫–æ–π —Ä–∞–±–æ—Ç–∞–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ:\n\n‚Ä¢ –ü—Ä–æ–µ–∫—Ç —Ä–∞–∑–≤–æ–¥–∫–∏ –ø–æ–¥ –≤–∞—à–∏ –Ω—É–∂–¥—ã\n‚Ä¢ –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã (–í–í–ì–Ω–≥)\n‚Ä¢ –©–∏—Ç–æ–∫ —Å –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π –∑–∞—â–∏—Ç–æ–π\n\n–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ –∫–≤–∞—Ä—Ç–∏—Ä–µ ‚Äî —Å–∫–æ–ª—å–∫–æ –∫–æ–º–Ω–∞—Ç, –∫–∞–∫–∞—è —Ç–µ—Ö–Ω–∏–∫–∞ –ø–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è? üí°'
      ],
      
      '—Å—Ç—É–¥–∏—è|–æ–¥–Ω—É—à–∫–∞|–æ–¥–Ω–æ–∫–æ–º–Ω–∞—Ç–Ω–∞—è|1-–∫–æ–º–Ω': [
        '–°—Ç—É–¥–∏–∏ –∏ –æ–¥–Ω—É—à–∫–∏ ‚Äî –Ω–∞—à –∫–æ–Ω—ë–∫! üè† –ó–Ω–∞–µ–º, –∫–∞–∫:\n\n‚Ä¢ –ì—Ä–∞–º–æ—Ç–Ω–æ –∑–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ\n‚Ä¢ –†–∞–∑–º–µ—Å—Ç–∏—Ç—å –≤—Å—ë –Ω—É–∂–Ω–æ–µ –∫–æ–º–ø–∞–∫—Ç–Ω–æ\n‚Ä¢ –°–¥–µ–ª–∞—Ç—å —Å–≤–µ—Ç–ª–æ –∏ –ø—Ä–æ—Å—Ç–æ—Ä–Ω–æ\n\n–ö–∞–∫–∞—è –ø–ª–æ—â–∞–¥—å? –ù–æ–≤–æ—Å—Ç—Ä–æ–π–∫–∞ –∏–ª–∏ –≤—Ç–æ—Ä–∏—á–∫–∞? –ï—Å—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞?',
        '–° –Ω–µ–±–æ–ª—å—à–∏–º–∏ –∫–≤–∞—Ä—Ç–∏—Ä–∞–º–∏ —Ä–∞–±–æ—Ç–∞–µ–º –º–Ω–æ–≥–æ ‚Äî –µ—Å—Ç—å –æ–ø—ã—Ç –∏ –∏–¥–µ–∏. –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ:\n\n‚Ä¢ –ü–ª–æ—â–∞–¥—å?\n‚Ä¢ –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ–π—á–∞—Å?\n‚Ä¢ –ß—Ç–æ –≤–∞–∂–Ω–æ: –º–µ—Å—Ç–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã, –≥–∞—Ä–¥–µ—Ä–æ–±, –∑–æ–Ω–∞ –æ—Ç–¥—ã—Ö–∞?\n\n–ü–æ–º–æ–≥—É —Å –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–æ–π! üìê'
      ],
      
      '–¥–∏–∑–∞–π–Ω|–ø—Ä–æ–µ–∫—Ç|–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è|–ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞|3d': [
        '–ú–æ–∂–µ–º —Å–¥–µ–ª–∞—Ç—å —Å –¥–∏–∑–∞–π–Ω-–ø—Ä–æ–µ–∫—Ç–æ–º –∏–ª–∏ –±–µ–∑ ‚Äî –∫–∞–∫ —É–¥–æ–±–Ω–µ–µ –≤–∞–º.\n\n‚Ä¢ –ü–ª–∞–Ω–∏—Ä–æ–≤–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ ‚Äî –≤–∫–ª—é—á–µ–Ω–æ\n‚Ä¢ –ü–æ–¥–±–æ—Ä –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –∏ —Ü–≤–µ—Ç–æ–≤ ‚Äî –≤–∫–ª—é—á–µ–Ω–æ\n‚Ä¢ –ü–æ–ª–Ω—ã–π –¥–∏–∑–∞–π–Ω-–ø—Ä–æ–µ–∫—Ç —Å 3D ‚Äî –æ—Ç–¥–µ–ª—å–Ω–æ\n\n–ß—Ç–æ –≤–∞–º –±–ª–∏–∂–µ: –≥–æ—Ç–æ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è –∏–ª–∏ –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π –ø—Ä–æ–µ–∫—Ç? üé®',
        '–ü–æ –¥–∏–∑–∞–π–Ω—É –µ—Å—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã:\n\n1. –ë–∞–∑–æ–≤–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)\n2. –≠—Å–∫–∏–∑–Ω—ã–π –ø—Ä–æ–µ–∫—Ç —Å –ø–æ–¥–±–æ—Ä–æ–º –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤\n3. –ü–æ–ª–Ω—ã–π –¥–∏–∑–∞–π–Ω-–ø—Ä–æ–µ–∫—Ç —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π\n\n–ß—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç? –ú–æ–≥—É –ø–æ–∫–∞–∑–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã –Ω–∞—à–∏—Ö —Ä–∞–±–æ—Ç. ‚ú®'
      ],
      
      '—Å–ø–∞—Å–∏–±–æ|–±–ª–∞–≥–æ–¥–∞—Ä—é|–æ—Ç–ª–∏—á–Ω–æ|—Å—É–ø–µ—Ä|–∫—Ä—É—Ç–æ': [
        '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞! üòä –ï—Å–ª–∏ –ø–æ—è–≤—è—Ç—Å—è –µ—â—ë –≤–æ–ø—Ä–æ—Å—ã ‚Äî –ø–∏—à–∏—Ç–µ, –≤—Å–µ–≥–¥–∞ —Ä–∞–¥ –ø–æ–º–æ—á—å.',
        '–†–∞–¥ –ø–æ–º–æ—á—å! –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –µ—â—ë –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è ‚Äî —è –∑–¥–µ—Å—å. –•–æ—Ä–æ—à–µ–≥–æ –¥–Ω—è! ‚òÄÔ∏è',
        '–ù–∞ –∑–¥–æ—Ä–æ–≤—å–µ! –ë—É–¥—É —Ä–∞–¥, –µ—Å–ª–∏ —Å–º–æ–≥—É –µ—â—ë —á–µ–º-—Ç–æ –ø–æ–º–æ—á—å. üôå'
      ],
      
      '–ø—Ä–∏–≤–µ—Ç|–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π|–¥–æ–±—Ä—ã–π –¥–µ–Ω—å|–¥–æ–±—Ä–æ–µ —É—Ç—Ä–æ|–¥–æ–±—Ä—ã–π –≤–µ—á–µ—Ä': [
        '–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! üëã –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å —Å –≤–∞—à–∏–º —Ä–µ–º–æ–Ω—Ç–æ–º?',
        '–î–æ–±—Ä—ã–π –¥–µ–Ω—å! –†–∞–¥ –≤–∞—Å –≤–∏–¥–µ—Ç—å. –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ, —á—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç? üè†',
        '–ü—Ä–∏–≤–µ—Ç! –ì–æ—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã. –ß—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–∑–Ω–∞—Ç—å? üòä'
      ]
    },
    
    // –û—Ç–≤–µ—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–µ—Å–ª–∏ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã)
    default: [
      '–ü–æ–Ω—è–ª –≤–∞—Å! –ß—Ç–æ–±—ã –¥–∞—Ç—å –±–æ–ª–µ–µ —Ç–æ—á–Ω—ã–π –æ—Ç–≤–µ—Ç, —Ä–∞—Å—Å–∫–∞–∂–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ:\n\n‚Ä¢ –ö–∞–∫–∞—è –ø–ª–æ—â–∞–¥—å –æ–±—ä–µ–∫—Ç–∞?\n‚Ä¢ –ß—Ç–æ —Å–µ–π—á–∞—Å –≤ –∫–≤–∞—Ä—Ç–∏—Ä–µ?\n‚Ä¢ –ö–∞–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ö–æ—Ç–∏—Ç–µ –ø–æ–ª—É—á–∏—Ç—å?\n\n–ò–ª–∏ –º–æ–∂–µ—Ç–µ –ø—Ä–∏—Å–ª–∞—Ç—å —Ñ–æ—Ç–æ/–ø–ª–∞–Ω–∏—Ä–æ–≤–∫—É ‚Äî —Ç–∞–∫ –±—É–¥–µ—Ç –Ω–∞–≥–ª—è–¥–Ω–µ–µ. üì∏',
      '–°–ø–∞—Å–∏–±–æ –∑–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é! –ß—Ç–æ–±—ã —è –º–æ–≥ –ø–æ–º–æ—á—å –ª—É—á—à–µ, —É—Ç–æ—á–Ω–∏—Ç–µ:\n\n‚Ä¢ –¢–∏–ø –ø–æ–º–µ—â–µ–Ω–∏—è –∏ –ø–ª–æ—â–∞–¥—å\n‚Ä¢ –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ\n‚Ä¢ –í–∞—à–∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è –∏ –±—é–¥–∂–µ—Ç\n\n–¢–∞–∫ —Å–º–æ–≥—É –¥–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏. üí¨',
      '–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ! –†–∞—Å—Å–∫–∞–∂–∏—Ç–µ —á—É—Ç—å –ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ –≤–∞—à–µ–º –ø—Ä–æ–µ–∫—Ç–µ ‚Äî –ø–ª–æ—â–∞–¥—å, —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –ø–æ–∂–µ–ª–∞–Ω–∏—è. –ò–ª–∏ –º–æ–∂–µ–º —Å–æ–∑–≤–æ–Ω–∏—Ç—å—Å—è –¥–ª—è –æ–±—Å—É–∂–¥–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π. üìû'
    ],
    
    // –°–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–µ—Ä–∞–±–æ—á–µ–º –≤—Ä–µ–º–µ–Ω–∏
    offHours: '–°–µ–π—á–∞—Å –Ω–µ—Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è (–º—ã —Ä–∞–±–æ—Ç–∞–µ–º —Å 9:00 –¥–æ 20:00). –í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ ‚Äî –æ—Ç–≤–µ—á—É, –∫–∞–∫ —Ç–æ–ª—å–∫–æ –≤—ã–π–¥—É –Ω–∞ —Å–≤—è–∑—å! üåô',
    
    // –ü–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —á–∞—Ç–∞
    welcome: [
      '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —á–∞—Ç –ü—Ä–æ—Ñ–†–µ–º–æ–Ω—Ç! üëã\n\n–Ø –ø–æ–º–æ–≥—É –≤–∞–º —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏ –ø–æ —Ä–µ–º–æ–Ω—Ç—É: —Ä–∞—Å—Å—á–∏—Ç–∞—é –ø—Ä–∏–º–µ—Ä–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å, –ø–æ–¥—Å–∫–∞–∂—É –ø–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º, –ø–æ–º–æ–≥—É —Å –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–æ–π.\n\n–ù–∞–ø–∏—à–∏—Ç–µ, —á—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç, –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ç–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –≤—ã—à–µ. ‚¨ÜÔ∏è',
      '–ü—Ä–∏–≤–µ—Ç! –Ø –º–µ–Ω–µ–¥–∂–µ—Ä –ü—Ä–æ—Ñ–†–µ–º–æ–Ω—Ç. üè†\n\n–ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ:\n‚Ä¢ –£–∑–Ω–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å —Ä–µ–º–æ–Ω—Ç–∞\n‚Ä¢ –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º\n‚Ä¢ –ó–∞–∫–∞–∑–∞—Ç—å –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –∑–∞–º–µ—Ä\n\n–ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?'
    ]
  };

  // ============================================================
  // –£–¢–ò–õ–ò–¢–´
  // ============================================================
  
  const Utils = {
    /**
     * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
     */
    generateId() {
      return `msg_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    },
    
    /**
     * –°–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ
     */
    randomBetween(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    },
    
    /**
     * –°–ª—É—á–∞–π–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –º–∞—Å—Å–∏–≤–∞
     */
    randomFrom(array) {
      return array[Math.floor(Math.random() * array.length)];
    },
    
    /**
     * –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
     */
    formatTime(date = new Date()) {
      return date.toLocaleTimeString('ru-RU', { 
        hour: '2-digit', 
        minute: '2-digit' 
      });
    },
    
    /**
     * –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
     */
    isWorkingHours() {
      const now = new Date();
      const hour = now.getHours();
      const day = now.getDay(); // 0 = –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ
      
      // –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ ‚Äî –≤—ã—Ö–æ–¥–Ω–æ–π
      if (day === 0) return false;
      
      return hour >= CONFIG.workingHours.start && hour < CONFIG.workingHours.end;
    },
    
    /**
     * –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ HTML
     */
    escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    },
    
    /**
     * –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–Ω–æ—Å–æ–≤ —Å—Ç—Ä–æ–∫ –≤ <br>
     */
    nl2br(text) {
      return text.replace(/\n/g, '<br>');
    },
    
    /**
     * –î–µ–±–∞—É–Ω—Å
     */
    debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }
  };

  // ============================================================
  // –•–†–ê–ù–ò–õ–ò–©–ï
  // ============================================================
  
  const Storage = {
    /**
     * –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞
     */
    getHistory() {
      try {
        const data = sessionStorage.getItem(CONFIG.storageKey);
        return data ? JSON.parse(data) : [];
      } catch (e) {
        console.warn('Chat: Failed to load history', e);
        return [];
      }
    },
    
    /**
     * –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞
     */
    saveHistory(messages) {
      try {
        // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π
        const trimmed = messages.slice(-CONFIG.maxHistoryMessages);
        sessionStorage.setItem(CONFIG.storageKey, JSON.stringify(trimmed));
      } catch (e) {
        console.warn('Chat: Failed to save history', e);
      }
    },
    
    /**
     * –î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
     */
    addMessage(message) {
      const history = this.getHistory();
      history.push(message);
      this.saveHistory(history);
      return history;
    },
    
    /**
     * –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
     */
    clearHistory() {
      try {
        sessionStorage.removeItem(CONFIG.storageKey);
      } catch (e) {
        console.warn('Chat: Failed to clear history', e);
      }
    }
  };

  // ============================================================
  // –ê–ù–ê–õ–ò–ó–ê–¢–û–† –°–û–û–ë–©–ï–ù–ò–ô
  // ============================================================
  
  const Analyzer = {
    /**
     * –ù–∞–π—Ç–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –æ—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ
     */
    findResponse(text) {
      const normalizedText = text.toLowerCase().trim();
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
      for (const [pattern, responses] of Object.entries(RESPONSES.keywords)) {
        const regex = new RegExp(pattern, 'i');
        if (regex.test(normalizedText)) {
          return Utils.randomFrom(responses);
        }
      }
      
      // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ—Ç–≤–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
      return Utils.randomFrom(RESPONSES.default);
    },
    
    /**
     * –ü–æ–ª—É—á–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
     */
    getWelcomeMessage() {
      return Utils.randomFrom(RESPONSES.welcome);
    },
    
    /**
     * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω—É–∂–Ω–æ –ª–∏ –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–µ—Ä–∞–±–æ—á–µ–º –≤—Ä–µ–º–µ–Ω–∏
     */
    shouldShowOffHoursMessage() {
      return !Utils.isWorkingHours();
    }
  };

  // ============================================================
  // UI –ö–û–ú–ü–û–ù–ï–ù–¢–´
  // ============================================================
  
  const UI = {
    elements: {},
    
    /**
     * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤
     */
    init() {
      this.elements = {
        form: document.getElementById('chat-form'),
        input: document.getElementById('chat-message'),
        thread: document.querySelector('.chat-thread'),
        typing: document.querySelector('.typing'),
        scrollBtn: document.querySelector('.scroll-down'),
        presetBtns: document.querySelectorAll('.js-chat-preset')
      };
      
      return this.elements.form && this.elements.thread;
    },
    
    /**
     * –°–æ–∑–¥–∞—Ç—å HTML —Å–æ–æ–±—â–µ–Ω–∏—è
     */
    createMessageHTML(message) {
      const { id, role, text, time, status } = message;
      const isUser = role === 'user';
      const roleClass = isUser ? 'message--user' : 'message--manager';
      const avatarText = isUser ? '–í—ã' : '–ú';
      const escapedText = Utils.nl2br(Utils.escapeHtml(text));
      
      return `
        <li class="message ${roleClass}" data-id="${id}" data-role="${role}">
          <div class="message__row">
            <div class="message__avatar" aria-hidden="true">${avatarText}</div>
            <div class="message__bubble">
              <p class="message__text">${escapedText}</p>
            </div>
          </div>
          <div class="message__meta">
            <time class="message__time">${time}</time>
            ${status ? `<span class="message__status">${status}</span>` : ''}
          </div>
        </li>
      `;
    },
    
    /**
     * –î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –ª–µ–Ω—Ç—É
     */
    addMessage(message) {
      const html = this.createMessageHTML(message);
      this.elements.thread.insertAdjacentHTML('beforeend', html);
      
      // –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è
      const newMsg = this.elements.thread.lastElementChild;
      newMsg.style.opacity = '0';
      newMsg.style.transform = 'translateY(10px)';
      
      requestAnimationFrame(() => {
        newMsg.style.transition = `opacity ${CONFIG.messageAnimationDuration}ms ease, transform ${CONFIG.messageAnimationDuration}ms ease`;
        newMsg.style.opacity = '1';
        newMsg.style.transform = 'translateY(0)';
      });
      
      // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫ —Å–æ–æ–±—â–µ–Ω–∏—é
      this.scrollToBottom();
      
      return newMsg;
    },
    
    /**
     * –û—Ç—Ä–∏—Å–æ–≤–∞—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é
     */
    renderHistory(messages) {
      this.elements.thread.innerHTML = '';
      messages.forEach(msg => {
        const html = this.createMessageHTML(msg);
        this.elements.thread.insertAdjacentHTML('beforeend', html);
      });
      this.scrollToBottom(false);
    },
    
    /**
     * –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "–ø–µ—á–∞—Ç–∞–µ—Ç"
     */
    showTyping() {
      if (this.elements.typing) {
        this.elements.typing.hidden = false;
        this.elements.typing.setAttribute('aria-hidden', 'false');
        this.scrollToBottom();
      }
    },
    
    /**
     * –°–∫—Ä—ã—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "–ø–µ—á–∞—Ç–∞–µ—Ç"
     */
    hideTyping() {
      if (this.elements.typing) {
        this.elements.typing.hidden = true;
        this.elements.typing.setAttribute('aria-hidden', 'true');
      }
    },
    
    /**
     * –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑
     */
    scrollToBottom(smooth = true) {
      const thread = this.elements.thread;
      if (thread) {
        thread.scrollTo({
          top: thread.scrollHeight,
          behavior: smooth ? 'smooth' : 'auto'
        });
      }
    },
    
    /**
     * –ü—Ä–æ–≤–µ—Ä–∫–∞, –Ω—É–∂–Ω–∞ –ª–∏ –∫–Ω–æ–ø–∫–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
     */
    updateScrollButton() {
      const thread = this.elements.thread;
      const btn = this.elements.scrollBtn;
      
      if (!thread || !btn) return;
      
      const isNearBottom = thread.scrollHeight - thread.scrollTop - thread.clientHeight < CONFIG.scrollThreshold;
      
      btn.classList.toggle('is-visible', !isNearBottom);
    },
    
    /**
     * –û—á–∏—Å—Ç–∏—Ç—å –ø–æ–ª–µ –≤–≤–æ–¥–∞
     */
    clearInput() {
      if (this.elements.input) {
        this.elements.input.value = '';
        this.elements.input.focus();
      }
    },
    
    /**
     * –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—Å—Ç –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
     */
    setInputValue(text) {
      if (this.elements.input) {
        this.elements.input.value = text;
        this.elements.input.focus();
        
        // –ü–æ–¥—Å–≤–µ—Ç–∫–∞ –ø–æ–ª—è
        this.elements.input.classList.add('is-highlighted');
        setTimeout(() => {
          this.elements.input.classList.remove('is-highlighted');
        }, 500);
      }
    },
    
    /**
     * –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –≤–≤–æ–¥
     */
    setInputDisabled(disabled) {
      if (this.elements.input) {
        this.elements.input.disabled = disabled;
      }
      const submitBtn = this.elements.form?.querySelector('[type="submit"]');
      if (submitBtn) {
        submitBtn.disabled = disabled;
      }
    }
  };

  // ============================================================
  // –ó–í–£–ö–û–í–´–ï –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø
  // ============================================================
  
  const Sound = {
    audio: null,
    
    init() {
      if (CONFIG.soundEnabled) {
        this.audio = new Audio(CONFIG.soundUrl);
        this.audio.volume = 0.5;
      }
    },
    
    play() {
      if (this.audio && CONFIG.soundEnabled) {
        this.audio.currentTime = 0;
        this.audio.play().catch(() => {});
      }
    }
  };

  // ============================================================
  // –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–†–û–õ–õ–ï–† –ß–ê–¢–ê
  // ============================================================
  
  const Chat = {
    isProcessing: false,
    history: [],
    
    /**
     * –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —á–∞—Ç–∞
     */
    init() {
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è UI
      if (!UI.init()) {
        console.warn('Chat: Required elements not found');
        return;
      }
      
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–≤—É–∫–∞
      Sound.init();
      
      // –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏
      this.history = Storage.getHistory();
      
      // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –∏–ª–∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
      if (this.history.length > 0) {
        UI.renderHistory(this.history);
      } else {
        this.sendWelcomeMessage();
      }
      
      // –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π
      this.bindEvents();
      
      // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å no-js
      document.documentElement.classList.remove('no-js');
      
      console.log('Chat: Initialized');
    },
    
    /**
     * –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π
     */
    bindEvents() {
      // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
      UI.elements.form?.addEventListener('submit', (e) => {
        e.preventDefault();
        this.handleSubmit();
      });
      
      // –ö–Ω–æ–ø–∫–∏ –ø—Ä–µ—Å–µ—Ç–æ–≤
      UI.elements.presetBtns?.forEach(btn => {
        btn.addEventListener('click', () => {
          const message = btn.dataset.message;
          if (message) {
            UI.setInputValue(message);
          }
        });
      });
      
      // –ö–Ω–æ–ø–∫–∞ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
      UI.elements.scrollBtn?.addEventListener('click', () => {
        UI.scrollToBottom();
      });
      
      // –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
      UI.elements.thread?.addEventListener('scroll', 
        Utils.debounce(() => UI.updateScrollButton(), 100)
      );
      
      // Enter –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ (–±–µ–∑ Shift)
      UI.elements.input?.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          this.handleSubmit();
        }
      });
      
      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤—ã—Å–æ—Ç–∞ textarea (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
      UI.elements.input?.addEventListener('input', () => {
        this.autoResizeInput();
      });
    },
    
    /**
     * –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤—ã—Å–æ—Ç–∞ –ø–æ–ª—è –≤–≤–æ–¥–∞
     */
    autoResizeInput() {
      const input = UI.elements.input;
      if (input && input.tagName === 'TEXTAREA') {
        input.style.height = 'auto';
        input.style.height = Math.min(input.scrollHeight, 150) + 'px';
      }
    },
    
    /**
     * –û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
     */
    sendWelcomeMessage() {
      const message = {
        id: Utils.generateId(),
        role: 'manager',
        text: Analyzer.getWelcomeMessage(),
        time: Utils.formatTime(),
        status: ''
      };
      
      this.history.push(message);
      Storage.saveHistory(this.history);
      UI.addMessage(message);
    },
    
    /**
     * –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
     */
    async handleSubmit() {
      const text = UI.elements.input?.value.trim();
      
      if (!text || this.isProcessing) return;
      
      this.isProcessing = true;
      UI.setInputDisabled(true);
      
      // –°–æ–∑–¥–∞—ë–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      const userMessage = {
        id: Utils.generateId(),
        role: 'user',
        text: text,
        time: Utils.formatTime(),
        status: '‚úì'
      };
      
      // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é –∏ UI
      this.history.push(userMessage);
      Storage.saveHistory(this.history);
      UI.addMessage(userMessage);
      UI.clearInput();
      
      // –ò–º–∏—Ç–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
      await this.simulateManagerResponse(text);
      
      this.isProcessing = false;
      UI.setInputDisabled(false);
    },
    
    /**
     * –°–∏–º—É–ª—è—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
     */
    async simulateManagerResponse(userText) {
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "–ø–µ—á–∞—Ç–∞–µ—Ç"
      const typingDelay = Utils.randomBetween(
        CONFIG.typingDelay.min, 
        CONFIG.typingDelay.max
      );
      
      await this.delay(typingDelay);
      UI.showTyping();
      
      // –ñ–¥—ë–º –ø–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º
      const responseDelay = Utils.randomBetween(
        CONFIG.responseDelay.min, 
        CONFIG.responseDelay.max
      );
      
      await this.delay(responseDelay);
      UI.hideTyping();
      
      // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞
      let responseText = Analyzer.findResponse(userText);
      
      // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –Ω–µ—Ä–∞–±–æ—á–µ–º –≤—Ä–µ–º–µ–Ω–∏
      if (Analyzer.shouldShowOffHoursMessage() && Math.random() > 0.7) {
        responseText += '\n\n' + RESPONSES.offHours;
      }
      
      // –°–æ–∑–¥–∞—ë–º —Å–æ–æ–±—â–µ–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä–∞
      const managerMessage = {
        id: Utils.generateId(),
        role: 'manager',
        text: responseText,
        time: Utils.formatTime(),
        status: ''
      };
      
      // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é –∏ UI
      this.history.push(managerMessage);
      Storage.saveHistory(this.history);
      UI.addMessage(managerMessage);
      
      // –ó–≤—É–∫–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
      Sound.play();
    },
    
    /**
     * –£—Ç–∏–ª–∏—Ç–∞ –∑–∞–¥–µ—Ä–∂–∫–∏
     */
    delay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }
  };

  // ============================================================
  // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
  // ============================================================
  
  // –ñ–¥—ë–º –∑–∞–≥—Ä—É–∑–∫–∏ DOM
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => Chat.init());
  } else {
    Chat.init();
  }
  
  // –≠–∫—Å–ø–æ—Ä—Ç –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
  window.ProfRemontChat = {
    Chat,
    UI,
    Storage,
    Utils,
    CONFIG
  };

})();